<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introduction &mdash; SphinxExample  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CWT-Cucumber" href="01_cwt_cucumber.html" />
    <link rel="prev" title="Coding with Thomas: Cucumber - A C/C++ Cucumber Interpreter" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            SphinxExample
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#how-i-started">How I started</a></li>
<li class="toctree-l2"><a class="reference internal" href="#crafting-interpreters-clox">Crafting Interpreters <em>clox</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="#feature-file-to-bytecode">Feature-File to Bytecode</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="01_cwt_cucumber.html">CWT-Cucumber</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_api.html">API Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SphinxExample</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Introduction</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/chapters/00_intro.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="admonition note" id="include-00-intro">
<p class="admonition-title">Note</p>
<p>This chapter is about all my thoughts, how I came to this project and how this interpreter works in general. It’s just an informative chapter and nice to know. You can skip this chapter if you are looking for the technical documentation of cwt-cucumber and its API.</p>
</div>
<section id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h1>
<p>This introduction is a summary of my reasons for starting this project and a description of how this interpreter works.</p>
<p>I started reading <a class="reference external" href="https://craftinginterpreters.com/">Crafting Interpreters by Robert Nystrom</a> because I wanted to learn how interpreters work. As a side note, I can highly recommend this book, I think it is one of the best books I have ever had. In his book you go step by step through the implementation of his scripting language <em>lox</em>. First there is <em>jlox</em>, the Java version and then there is <em>clox</em>, the C version. Find both implementations on <a class="reference external" href="https://github.com/munificent/craftinginterpreters">GitHub</a>.</p>
<p>After reading and implementing the interpreter example from the books, I wanted to do a meaningful project on my own. But implementing another general-purpose scripting language didn’t feel right, because it would be more or less a copy of <em>lox</em>. Now consider that Cucumber is different. In Cucumber, you don’t have the freedom to write any script you want. The rules for it are pretty much set with given-when-then. In my projects from work I often use Cucumber and I like the idea. And this brought me to the idea to implement this interpreter.</p>
<p>So this is not really a competing project to the official <a class="reference external" href="https://github.com/cucumber/cucumber-cpp">Cucumber-cpp</a>. It is an educational project for me to fully understand the C implementation of <em>Crafting Interpreters</em>. And maybe it will turn out to be a good project.</p>
<section id="how-i-started">
<h2>How I started<a class="headerlink" href="#how-i-started" title="Link to this heading"></a></h2>
<p>At first it seemed really simple compared to a scripting language, because the structure is pretty much defined by the Cucumber language. There were some tricky parts, but I guess there was always a solution. Anyway, to get my initial idea, take a look at this feature file:</p>
<div class="highlight-gherkin notranslate"><div class="highlight"><pre><span></span><span class="k">Feature:</span><span class="nf"> feature</span>

<span class="nf">  </span><span class="k">Scenario:</span><span class="nf"> scenario</span>
<span class="k">    Given </span><span class="nf">first_step</span>
<span class="nf">    </span><span class="k">When </span><span class="nf">second_step</span>
<span class="nf">    </span><span class="k">Then </span><span class="nf">third_step</span>
</pre></div>
</div>
<p>If we run this feature file with a valid implementation of these steps, cucumber will execute the three steps and evaluate them. If we were to translate this feature file into <em>lox</em> from Crafting Interpreters, it might look something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fun</span> <span class="n">feature</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">fun</span> <span class="n">scenario</span><span class="p">()</span>
    <span class="p">{</span>
      <span class="n">first_step</span><span class="p">();</span>
      <span class="n">second_step</span><span class="p">();</span>
      <span class="n">third_step</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="n">scenario</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">feature</span><span class="p">();</span>
</pre></div>
</div>
<p>This means that all steps are native functions (like print functions, clock or time functions, etc.). A scenario is nested within a feature function, and right after the function definition of each, we call it. And this is basically what happens. Of course there is more, like hooks, tags, failing steps, etc., which makes it more complex, but this was a start.</p>
</section>
<section id="crafting-interpreters-clox">
<h2>Crafting Interpreters <em>clox</em><a class="headerlink" href="#crafting-interpreters-clox" title="Link to this heading"></a></h2>
<p>Lets have a look at the <em>clox</em> interpreter, which compiles the script into a chunk of byte code. This chunk is then executed by a virtual machine. The cool thing here is, that you can print the byte code and the stack during execution. So lets have another look and replace some native functions with prints. They represent a step now:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fun</span> <span class="n">feature</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">fun</span> <span class="n">scenario</span><span class="p">()</span>
    <span class="p">{</span>
      <span class="nb">print</span> <span class="s2">&quot;Given any initial step&quot;</span><span class="p">;</span>
      <span class="nb">print</span> <span class="s2">&quot;When something happens&quot;</span><span class="p">;</span>
      <span class="nb">print</span> <span class="s2">&quot;Then we evaluate something&quot;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="n">scenario</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">feature</span><span class="p">();</span>
</pre></div>
</div>
<p>And this is translated into bytecode:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3.:</span>
<span class="o">==</span> <span class="n">scenario</span> <span class="o">==</span>
<span class="mi">0000</span>    <span class="mi">5</span> <span class="n">OP_CONSTANT</span>         <span class="mi">0</span> <span class="s1">&#39;Given any initial step&#39;</span>
<span class="mi">0002</span>    <span class="o">|</span> <span class="n">OP_PRINT</span>
<span class="mi">0003</span>    <span class="mi">6</span> <span class="n">OP_CONSTANT</span>         <span class="mi">1</span> <span class="s1">&#39;When something happens&#39;</span>
<span class="mi">0005</span>    <span class="o">|</span> <span class="n">OP_PRINT</span>
<span class="mi">0006</span>    <span class="mi">7</span> <span class="n">OP_CONSTANT</span>         <span class="mi">2</span> <span class="s1">&#39;Then we evaluate something&#39;</span>
<span class="mi">0008</span>    <span class="o">|</span> <span class="n">OP_PRINT</span>
<span class="mi">0009</span>    <span class="mi">8</span> <span class="n">OP_NIL</span>
<span class="mi">0010</span>    <span class="o">|</span> <span class="n">OP_RETURN</span>

<span class="c1"># 2.:</span>
<span class="o">==</span> <span class="n">feature</span> <span class="o">==</span>
<span class="mi">0000</span>    <span class="mi">8</span> <span class="n">OP_CONSTANT</span>         <span class="mi">0</span> <span class="s1">&#39;&lt;fn scenario&gt;&#39;</span>
<span class="mi">0002</span>    <span class="mi">9</span> <span class="n">OP_GET_LOCAL</span>        <span class="mi">1</span>
<span class="mi">0004</span>    <span class="o">|</span> <span class="n">OP_CALL</span>             <span class="mi">0</span>
<span class="mi">0006</span>    <span class="o">|</span> <span class="n">OP_POP</span>
<span class="mi">0007</span>   <span class="mi">10</span> <span class="n">OP_NIL</span>
<span class="mi">0008</span>    <span class="o">|</span> <span class="n">OP_RETURN</span>

<span class="c1"># 1.:</span>
<span class="o">==</span> <span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span> <span class="o">==</span>
<span class="mi">0000</span>   <span class="mi">10</span> <span class="n">OP_CONSTANT</span>         <span class="mi">1</span> <span class="s1">&#39;&lt;fn feature&gt;&#39;</span>
<span class="mi">0002</span>    <span class="o">|</span> <span class="n">OP_DEFINE_GLOBAL</span>    <span class="mi">0</span> <span class="s1">&#39;feature&#39;</span>
<span class="mi">0004</span>   <span class="mi">12</span> <span class="n">OP_GET_GLOBAL</span>       <span class="mi">2</span> <span class="s1">&#39;feature&#39;</span>
<span class="mi">0006</span>    <span class="o">|</span> <span class="n">OP_CALL</span>             <span class="mi">0</span>
<span class="mi">0008</span>    <span class="o">|</span> <span class="n">OP_POP</span>
<span class="mi">0009</span>    <span class="o">|</span> <span class="n">OP_NIL</span>
<span class="mi">0010</span>    <span class="o">|</span> <span class="n">OP_RETURN</span>
</pre></div>
</div>
<p>Now we can see three parts.</p>
<ol class="arabic simple">
<li><p>The script: A global function is defined and the call is emitted.</p></li>
<li><p>This represents the function or its function body in which the nested scenario is defined. After its declaration we emit the call.</p></li>
<li><p>The execution of each step works the same way, we pull a constant (which is later the step) and then we call the underlying function, which in this case is a single print.</p></li>
</ol>
<p>And this was my starting point for cwt-cucumber.</p>
</section>
<section id="feature-file-to-bytecode">
<h2>Feature-File to Bytecode<a class="headerlink" href="#feature-file-to-bytecode" title="Link to this heading"></a></h2>
<p>I left these debugging prints in the source. During CMake configuration you can set <cite>STACK_TRACE=1</cite> and all the bytecode and its stack will be printed to the terminal. And it really helped me during the implementation. To be honest, it has grown quite a bit and can be a bit hard to read the stack, because it overlaps with the general prints. But let’s have a look at the chunk in which a feature file is translated. I used some <cite>box</cite> examples:</p>
<div class="highlight-gherkin notranslate"><div class="highlight"><pre><span></span><span class="c"># ./examples/features/first_examples.feature</span>

<span class="k">Feature:</span><span class="nf"> My First Feature File</span>
<span class="nf">  Just for demonstration</span>

<span class="nf">  </span><span class="k">Scenario:</span><span class="nf"> An arbitrary box</span>
<span class="k">    Given </span><span class="nf">A box with </span><span class="s">2</span><span class="nf"> x </span><span class="s">2</span><span class="nf"> x </span><span class="s">2</span>
<span class="nf">    </span><span class="k">When </span><span class="nf">I open the box</span>
<span class="nf">    </span><span class="k">Then </span><span class="nf">The box is open</span>
<span class="nf">    </span><span class="k">And </span><span class="nf">The volume is </span><span class="s">8</span>
</pre></div>
</div>
<p>As far as I noticed, it is valid to have same scenario names in Cucumber. And if I want to create a function call from the the scenarios and features, I can not rely on its name. Therefore I used the filepaths and the linenumber as function name.</p>
<p>If we now go through the chunk as above from 1. to 3. step by step, we will see. Let us start with 1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">==</span> <span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span> <span class="o">==</span>
<span class="mi">0000</span>   <span class="mi">10</span> <span class="n">OP_CONSTANT</span>         <span class="mi">0</span> <span class="s1">&#39;&lt;fn ./examples/features/first_example.feature:3&gt;&#39;</span>
<span class="mi">0002</span>    <span class="o">|</span> <span class="n">OP_DEFINE_VARIABLE</span>    <span class="mi">1</span> <span class="s1">&#39;./examples/features/first_example.feature:3&#39;</span>
<span class="mi">0004</span>    <span class="o">|</span> <span class="n">OP_CALL</span>             <span class="mi">0</span>
<span class="mi">0006</span>    <span class="o">|</span> <span class="n">OP_RETURN</span>
</pre></div>
</div>
<p>And this is pretty straightforward: the feature is represented by a global function, with its path and linenumber as the function name. This is pushed to the stack and then, we immediately call it.</p>
<p>Now we go into the function body of the feature, which means we are now in the chunk <cite>./examples/features/first_example.feature:3</cite>. In order to make it more understandable, I will add my comments to the chunk:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">==</span> <span class="o">./</span><span class="n">examples</span><span class="o">/</span><span class="n">features</span><span class="o">/</span><span class="n">first_example</span><span class="o">.</span><span class="n">feature</span><span class="p">:</span><span class="mi">3</span> <span class="o">==</span>
<span class="c1"># I added print operations, to later enable/disable them during the compilation.</span>
<span class="c1"># we push the string to print and access it in the each following print operation</span>
<span class="mi">0000</span>    <span class="mi">3</span> <span class="n">OP_CONSTANT</span>         <span class="mi">0</span> <span class="s1">&#39;Feature: My First Feature File&#39;</span>
<span class="mi">0002</span>    <span class="o">|</span> <span class="n">OP_PRINT_LINE</span>       <span class="mi">0</span>
<span class="mi">0004</span>    <span class="o">|</span> <span class="n">OP_CONSTANT</span>         <span class="mi">1</span> <span class="s1">&#39;./examples/features/first_example.feature:3&#39;</span>
<span class="mi">0006</span>    <span class="o">|</span> <span class="n">OP_PRINT_LINE</span>       <span class="mi">1</span>
<span class="mi">0008</span>    <span class="o">|</span> <span class="n">OP_PRINT_LINEBREAK</span>
<span class="mi">0009</span>    <span class="o">|</span> <span class="n">OP_PRINT_LINEBREAK</span>

<span class="c1"># an internal hook to reset the scenario context</span>
<span class="c1"># you find a detailed explanation for the context and hooks in this documentation too</span>
<span class="c1"># and after we get the hook, we call it</span>
<span class="mi">0010</span>   <span class="mi">10</span> <span class="n">OP_CONSTANT</span>         <span class="mi">2</span> <span class="s1">&#39;reset_context&#39;</span>
<span class="mi">0012</span>    <span class="o">|</span> <span class="n">OP_HOOK</span>             <span class="mi">0</span>

<span class="c1"># same happens with the hook before</span>
<span class="mi">0014</span>    <span class="o">|</span> <span class="n">OP_CONSTANT</span>         <span class="mi">3</span> <span class="s1">&#39;before&#39;</span>
<span class="mi">0016</span>    <span class="o">|</span> <span class="n">OP_HOOK</span>             <span class="mi">0</span>

<span class="c1"># now there is the actual scenario at line 6, it get pushed to the stack</span>
<span class="c1"># and we&#39;ll call it.</span>
<span class="mi">0018</span>    <span class="o">|</span> <span class="n">OP_CONSTANT</span>         <span class="mi">4</span> <span class="s1">&#39;&lt;fn ./examples/features/first_example.feature:6&gt;&#39;</span>
<span class="mi">0020</span>    <span class="o">|</span> <span class="n">OP_CALL</span>             <span class="mi">0</span>

<span class="c1"># after a scenario call there is another hook which might get called:</span>
<span class="mi">0022</span>    <span class="o">|</span> <span class="n">OP_CONSTANT</span>         <span class="mi">5</span> <span class="s1">&#39;after&#39;</span>
<span class="mi">0024</span>    <span class="o">|</span> <span class="n">OP_HOOK</span>             <span class="mi">0</span>

<span class="c1"># we evaluate the scenario result in the vm and we&#39;re done</span>
<span class="mi">0026</span>    <span class="o">|</span> <span class="n">OP_SCENARIO_RESULT</span>
<span class="mi">0027</span>    <span class="o">|</span> <span class="n">OP_PRINT_LINEBREAK</span>
<span class="mi">0028</span>    <span class="o">|</span> <span class="n">OP_RETURN</span>
</pre></div>
</div>
<p>And now the chunk for the scenario, which is getting bigger again:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># we&#39;re in line 6 now, inside the body of the scenario</span>
<span class="o">==</span> <span class="o">./</span><span class="n">examples</span><span class="o">/</span><span class="n">features</span><span class="o">/</span><span class="n">first_example</span><span class="o">.</span><span class="n">feature</span><span class="p">:</span><span class="mi">6</span> <span class="o">==</span>
<span class="c1"># we begin with prints</span>
<span class="mi">0000</span>    <span class="mi">6</span> <span class="n">OP_CONSTANT</span>         <span class="mi">0</span> <span class="s1">&#39;Scenario: An arbitrary box&#39;</span>
<span class="mi">0002</span>    <span class="o">|</span> <span class="n">OP_PRINT_LINE</span>       <span class="mi">0</span>
<span class="mi">0004</span>    <span class="o">|</span> <span class="n">OP_CONSTANT</span>         <span class="mi">1</span> <span class="s1">&#39;./examples/features/first_example.feature:6&#39;</span>
<span class="mi">0006</span>    <span class="o">|</span> <span class="n">OP_PRINT_LINE</span>       <span class="mi">1</span>
<span class="mi">0008</span>    <span class="o">|</span> <span class="n">OP_PRINT_LINEBREAK</span>

<span class="c1"># the function name (= its location) and the given name to the stack</span>
<span class="c1"># and initialize it</span>
<span class="c1"># this is necessary because if it fails we need this later</span>
<span class="mi">0009</span>    <span class="o">|</span> <span class="n">OP_CONSTANT</span>         <span class="mi">2</span> <span class="s1">&#39;./examples/features/first_example.feature:6&#39;</span>
<span class="mi">0011</span>    <span class="o">|</span> <span class="n">OP_CONSTANT</span>         <span class="mi">3</span> <span class="s1">&#39;Scenario: An arbitrary box&#39;</span>
<span class="mi">0013</span>    <span class="o">|</span> <span class="n">OP_INIT_SCENARIO</span>

<span class="c1"># now we have a jump operation before every step</span>
<span class="c1"># because if a step fails, we want to skip the following steps</span>
<span class="c1"># (for the first step this does not make to much sense, I know)</span>
<span class="c1"># and then we have another hook which can be there, the call to the step</span>
<span class="c1"># and another hook after the step</span>
<span class="mi">0014</span>    <span class="mi">7</span> <span class="n">OP_JUMP_IF_FAILED</span>   <span class="mi">14</span> <span class="o">-&gt;</span> <span class="mi">27</span>
<span class="mi">0017</span>    <span class="o">|</span> <span class="n">OP_CONSTANT</span>         <span class="mi">4</span> <span class="s1">&#39;before_step&#39;</span>
<span class="mi">0019</span>    <span class="o">|</span> <span class="n">OP_HOOK</span>             <span class="mi">0</span>
<span class="mi">0021</span>    <span class="mi">8</span> <span class="n">OP_CALL_STEP</span>        <span class="mi">5</span> <span class="s1">&#39;A box with 2 x 2 x 2&#39;</span>
<span class="mi">0023</span>    <span class="o">|</span> <span class="n">OP_CONSTANT</span>         <span class="mi">6</span> <span class="s1">&#39;after_step&#39;</span>
<span class="mi">0025</span>    <span class="o">|</span> <span class="n">OP_HOOK</span>             <span class="mi">0</span>

<span class="c1"># now we executed the step and set the step result</span>
<span class="mi">0027</span>    <span class="o">|</span> <span class="n">OP_PRINT_STEP_RESULT</span>    <span class="mi">7</span> <span class="s1">&#39;A box with 2 x 2 x 2&#39;</span>
<span class="mi">0029</span>    <span class="o">|</span> <span class="n">OP_SET_STEP_RESULT</span>
<span class="mi">0030</span>    <span class="o">|</span> <span class="n">OP_CONSTANT</span>         <span class="mi">8</span> <span class="s1">&#39;./examples/features/first_example.feature:7&#39;</span>
<span class="mi">0032</span>    <span class="o">|</span> <span class="n">OP_PRINT_LINE</span>       <span class="mi">1</span>
<span class="mi">0034</span>    <span class="o">|</span> <span class="n">OP_PRINT_LINEBREAK</span>

<span class="c1"># and this continues now for all steps:</span>
<span class="c1"># if the previous step failed we skip to 42, else we stay and execute the hooks and the step:</span>
<span class="mi">0035</span>    <span class="o">|</span> <span class="n">OP_JUMP_IF_FAILED</span>   <span class="mi">35</span> <span class="o">-&gt;</span> <span class="mi">48</span>
<span class="mi">0038</span>    <span class="o">|</span> <span class="n">OP_CONSTANT</span>         <span class="mi">9</span> <span class="s1">&#39;before_step&#39;</span>
<span class="mi">0040</span>    <span class="o">|</span> <span class="n">OP_HOOK</span>             <span class="mi">0</span>
<span class="mi">0042</span>    <span class="mi">9</span> <span class="n">OP_CALL_STEP</span>       <span class="mi">10</span> <span class="s1">&#39;I open the box&#39;</span>
<span class="mi">0044</span>    <span class="o">|</span> <span class="n">OP_CONSTANT</span>        <span class="mi">11</span> <span class="s1">&#39;after_step&#39;</span>
<span class="mi">0046</span>    <span class="o">|</span> <span class="n">OP_HOOK</span>             <span class="mi">0</span>

<span class="c1"># if we skip, we end up here: setting its result as skipped</span>
<span class="mi">0048</span>    <span class="o">|</span> <span class="n">OP_PRINT_STEP_RESULT</span>   <span class="mi">12</span> <span class="s1">&#39;I open the box&#39;</span>
<span class="mi">0050</span>    <span class="o">|</span> <span class="n">OP_SET_STEP_RESULT</span>
<span class="mi">0051</span>    <span class="o">|</span> <span class="n">OP_CONSTANT</span>        <span class="mi">13</span> <span class="s1">&#39;./examples/features/first_example.feature:8&#39;</span>
<span class="mi">0053</span>    <span class="o">|</span> <span class="n">OP_PRINT_LINE</span>       <span class="mi">1</span>
<span class="mi">0055</span>    <span class="o">|</span> <span class="n">OP_PRINT_LINEBREAK</span>
<span class="mi">0056</span>    <span class="o">|</span> <span class="n">OP_JUMP_IF_FAILED</span>   <span class="mi">56</span> <span class="o">-&gt;</span> <span class="mi">69</span>
<span class="mi">0059</span>    <span class="o">|</span> <span class="n">OP_CONSTANT</span>        <span class="mi">14</span> <span class="s1">&#39;before_step&#39;</span>
<span class="mi">0061</span>    <span class="o">|</span> <span class="n">OP_HOOK</span>             <span class="mi">0</span>
<span class="mi">0063</span>   <span class="mi">10</span> <span class="n">OP_CALL_STEP</span>       <span class="mi">15</span> <span class="s1">&#39;The box is open &#39;</span>
<span class="mi">0065</span>    <span class="o">|</span> <span class="n">OP_CONSTANT</span>        <span class="mi">16</span> <span class="s1">&#39;after_step&#39;</span>
<span class="mi">0067</span>    <span class="o">|</span> <span class="n">OP_HOOK</span>             <span class="mi">0</span>

<span class="c1"># if we skip, we end up here: setting its result as skipped</span>
<span class="mi">0069</span>    <span class="o">|</span> <span class="n">OP_PRINT_STEP_RESULT</span>   <span class="mi">17</span> <span class="s1">&#39;The box is open &#39;</span>
<span class="mi">0071</span>    <span class="o">|</span> <span class="n">OP_SET_STEP_RESULT</span>
<span class="mi">0072</span>    <span class="o">|</span> <span class="n">OP_CONSTANT</span>        <span class="mi">18</span> <span class="s1">&#39;./examples/features/first_example.feature:9&#39;</span>
<span class="mi">0074</span>    <span class="o">|</span> <span class="n">OP_PRINT_LINE</span>       <span class="mi">1</span>
<span class="mi">0076</span>    <span class="o">|</span> <span class="n">OP_PRINT_LINEBREAK</span>
<span class="mi">0077</span>    <span class="o">|</span> <span class="n">OP_JUMP_IF_FAILED</span>   <span class="mi">77</span> <span class="o">-&gt;</span> <span class="mi">90</span>
<span class="mi">0080</span>    <span class="o">|</span> <span class="n">OP_CONSTANT</span>        <span class="mi">19</span> <span class="s1">&#39;before_step&#39;</span>
<span class="mi">0082</span>    <span class="o">|</span> <span class="n">OP_HOOK</span>             <span class="mi">0</span>
<span class="mi">0084</span>    <span class="o">|</span> <span class="n">OP_CALL_STEP</span>       <span class="mi">20</span> <span class="s1">&#39;The volume is 8 &#39;</span>
<span class="mi">0086</span>    <span class="o">|</span> <span class="n">OP_CONSTANT</span>        <span class="mi">21</span> <span class="s1">&#39;after_step&#39;</span>
<span class="mi">0088</span>    <span class="o">|</span> <span class="n">OP_HOOK</span>             <span class="mi">0</span>

<span class="c1"># if we skip, we end up here: setting its result as skipped</span>
<span class="mi">0090</span>    <span class="o">|</span> <span class="n">OP_PRINT_STEP_RESULT</span>   <span class="mi">22</span> <span class="s1">&#39;The volume is 8 &#39;</span>
<span class="mi">0092</span>    <span class="o">|</span> <span class="n">OP_SET_STEP_RESULT</span>
<span class="mi">0093</span>    <span class="o">|</span> <span class="n">OP_CONSTANT</span>        <span class="mi">23</span> <span class="s1">&#39;./examples/features/first_example.feature:10&#39;</span>
<span class="mi">0095</span>    <span class="o">|</span> <span class="n">OP_PRINT_LINE</span>       <span class="mi">1</span>
<span class="mi">0097</span>    <span class="o">|</span> <span class="n">OP_PRINT_LINEBREAK</span>

<span class="c1"># and there we are, scenario done, up to 4 steps executed (or skipped)</span>
<span class="c1"># and we return from the scenario</span>
<span class="mi">0098</span>    <span class="o">|</span> <span class="n">OP_RETURN</span>
</pre></div>
</div>
<p>And this is essentially what happens under the hood when you run this cucumber interpreter. The feature file is compiled into this chunk and executed in its vm. The final output from the user perspective (without the stack trace) looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./build/bin/box ./examples/features/first_example.feature

  Feature: My First Feature File  ./examples/features/first_example.feature:3

  Scenario: An arbitrary box  ./examples/features/first_example.feature:6
[   PASSED    ] A box with 2 x 2 x 2  ./examples/features/first_example.feature:7
[   PASSED    ] I open the box  ./examples/features/first_example.feature:8
[   PASSED    ] The box is open   ./examples/features/first_example.feature:9
[   PASSED    ] The volume is 8   ./examples/features/first_example.feature:10


1 Scenarios (1 passed)
4 Steps (4 passed)
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="Coding with Thomas: Cucumber - A C/C++ Cucumber Interpreter" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="01_cwt_cucumber.html" class="btn btn-neutral float-right" title="CWT-Cucumber" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Thomas.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>