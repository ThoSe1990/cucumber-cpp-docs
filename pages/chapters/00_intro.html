<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introduction &mdash; SphinxExample  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Cucumber cpp" href="01_cucumber_cpp.html" />
    <link rel="prev" title="cucumber-cpp: A C++20 Cucumber Interpreter by Coding with Thomas" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            SphinxExample
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#how-i-started">How I started</a></li>
<li class="toctree-l2"><a class="reference internal" href="#crafting-interpreters-clox">Crafting Interpreters <em>clox</em></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-first-example">The First Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="01_cucumber_cpp.html">Cucumber cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_api.html">API Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SphinxExample</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Introduction</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/chapters/00_intro.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="admonition note" id="include-00-intro">
<p class="admonition-title">Note</p>
<p>This chapter is about all my thoughts, how I came to this project and how this interpreter works in general. It’s just an informative chapter and nice to know. You can skip this chapter if you are looking for the technical documentation of cwt-cucumber and its API.</p>
</div>
<section id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h1>
<p>This introduction is a summary of my reasons for starting this project and a description of how this interpreter works.</p>
<p>I started reading <a class="reference external" href="https://craftinginterpreters.com/">Crafting Interpreters by Robert Nystrom</a> because I wanted to learn how interpreters work. As a side note, I can highly recommend this book, I think it is one of the best books I have ever had. In his book you go step by step through the implementation of his scripting language <em>lox</em>. First there is <em>jlox</em>, the Java version and then there is <em>clox</em>, the C version. Find both implementations on <a class="reference external" href="https://github.com/munificent/craftinginterpreters">GitHub</a>.</p>
<p>After reading and implementing the interpreter example from the books, I wanted to do a meaningful project on my own. But implementing another general-purpose scripting language didn’t feel right, because it would be more or less a copy of <em>lox</em>. Now consider that Cucumber is different. In Cucumber, you don’t have the freedom to write any script you want. The rules for it are pretty much set with given-when-then. In my projects from work I often use Cucumber and I like the idea. And this brought me to the idea to implement this interpreter.</p>
<p>So this is not really a competing project to the official <a class="reference external" href="https://github.com/cucumber/cucumber-cpp">Cucumber-cpp</a>. It is an educational project for me to fully understand the C implementation of <em>Crafting Interpreters</em>. And maybe it will turn out to be a good project.</p>
<section id="how-i-started">
<h2>How I started<a class="headerlink" href="#how-i-started" title="Link to this heading"></a></h2>
<p>At first it seemed really simple compared to a scripting language, because the structure is pretty much defined by the Cucumber language. There were some tricky parts, but I guess there was always a solution. Anyway, to get my initial idea, take a look at this feature file:</p>
<div class="highlight-gherkin notranslate"><div class="highlight"><pre><span></span><span class="k">Feature:</span><span class="nf"> feature</span>

<span class="nf">  </span><span class="k">Scenario:</span><span class="nf"> scenario</span>
<span class="k">    Given </span><span class="nf">first_step</span>
<span class="nf">    </span><span class="k">When </span><span class="nf">second_step</span>
<span class="nf">    </span><span class="k">Then </span><span class="nf">third_step</span>
</pre></div>
</div>
<p>If we run this feature file with a valid implementation of these steps, cucumber will execute the three steps and evaluate them. If we were to translate this feature file into <em>lox</em> from Crafting Interpreters, it might look something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fun</span> <span class="n">feature</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">fun</span> <span class="n">scenario</span><span class="p">()</span>
    <span class="p">{</span>
      <span class="n">first_step</span><span class="p">();</span>
      <span class="n">second_step</span><span class="p">();</span>
      <span class="n">third_step</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="n">scenario</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">feature</span><span class="p">();</span>
</pre></div>
</div>
<p>This means that all steps are native functions (like print functions, clock or time functions, etc.). A scenario is nested within a feature function, and right after the function definition of each, we call it. And this is basically what happens. Of course there is more, like hooks, tags, failing steps, etc., which makes it more complex, but this was a start.</p>
</section>
<section id="crafting-interpreters-clox">
<h2>Crafting Interpreters <em>clox</em><a class="headerlink" href="#crafting-interpreters-clox" title="Link to this heading"></a></h2>
<p>Lets have a look at the <em>clox</em> interpreter, which compiles the script into a chunk of byte code. This chunk is then executed by a virtual machine. The cool thing here is, that you can print the byte code and the stack during execution. So lets have another look and replace some native functions with prints. They represent a step now:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fun</span> <span class="n">feature</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">fun</span> <span class="n">scenario</span><span class="p">()</span>
    <span class="p">{</span>
      <span class="nb">print</span> <span class="s2">&quot;Given any initial step&quot;</span><span class="p">;</span>
      <span class="nb">print</span> <span class="s2">&quot;When something happens&quot;</span><span class="p">;</span>
      <span class="nb">print</span> <span class="s2">&quot;Then we evaluate something&quot;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="n">scenario</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">feature</span><span class="p">();</span>
</pre></div>
</div>
<p>And this is translated into bytecode.</p>
<section id="the-first-example">
<h3>The First Example<a class="headerlink" href="#the-first-example" title="Link to this heading"></a></h3>
<p>Lets see this by example, what happens. Consider the first example <code class="docutils literal notranslate"><span class="pre">./examples/features/1_first_scenario.feature</span></code></p>
<div class="highlight-gherkin notranslate"><div class="highlight"><pre><span></span><span class="k">Feature:</span><span class="nf"> My first feature</span>
<span class="nf">  This is my cucumber-cpp hello world</span>

<span class="nf">  </span><span class="k">Scenario:</span><span class="nf"> First Scenario</span>
<span class="k">    Given </span><span class="nf">An empty box</span>
<span class="nf">    </span><span class="k">When </span><span class="nf">I place </span><span class="s">2</span><span class="nf"> x &quot;</span><span class="s">apple</span><span class="nf">&quot; in it</span>
<span class="nf">    </span><span class="k">Then </span><span class="nf">The box contains </span><span class="s">2</span><span class="nf"> item(s)</span>
</pre></div>
</div>
<p>Now if provide the define <code class="docutils literal notranslate"><span class="pre">PRINT_STACK</span></code> to enable the debug prints (which were very helpful during implementation) we can go through the different compiled chunks. First we start with the <code class="docutils literal notranslate"><span class="pre">script</span></code> chunk:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">==</span> <span class="n">script</span> <span class="o">==</span>
<span class="mi">0000</span>    <span class="mi">11</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">constant</span>   <span class="mi">0</span> <span class="s1">&#39;&lt;.\examples</span><span class="se">\f</span><span class="s1">eatures</span><span class="se">\1</span><span class="s1">_first_scenario.feature:2&gt;&#39;</span>
<span class="mi">0002</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">define_var</span>  <span class="mi">1</span> <span class="s1">&#39;.\examples</span><span class="se">\f</span><span class="s1">eatures</span><span class="se">\1</span><span class="s1">_first_scenario.feature:2&#39;</span>
<span class="mi">0004</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">get_var</span>     <span class="mi">1</span> <span class="s1">&#39;.\examples</span><span class="se">\f</span><span class="s1">eatures</span><span class="se">\1</span><span class="s1">_first_scenario.feature:2&#39;</span>
<span class="mi">0006</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">call</span>        <span class="mi">0</span>
<span class="mi">0008</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">func_return</span>
</pre></div>
</div>
<p>And this is just the <code class="docutils literal notranslate"><span class="pre">Feature</span></code>. All created functions are named by their filepath and linenumber. And since we want to call the feature we have <code class="docutils literal notranslate"><span class="pre">op_code::call</span></code> there, which loads the previous pushed varaible <code class="docutils literal notranslate"><span class="pre">.\examples\features\1_first_scenario.feature:2</span></code></p>
<p>Next, we have the <code class="docutils literal notranslate"><span class="pre">Scenario</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">==</span> <span class="o">.</span>\<span class="n">examples</span>\<span class="n">features</span>\<span class="mi">1</span><span class="n">_first_scenario</span><span class="o">.</span><span class="n">feature</span><span class="p">:</span><span class="mi">2</span> <span class="o">==</span>
<span class="mi">0000</span>    <span class="mi">2</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">print_linebreak</span>
<span class="mi">0001</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">constant</span>    <span class="mi">1</span> <span class="s1">&#39;Feature: My first feature&#39;</span>
<span class="mi">0003</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="nb">print</span>       <span class="mi">0</span>
<span class="mi">0005</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">print_indent</span>
<span class="mi">0006</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">constant</span>    <span class="mi">0</span> <span class="s1">&#39;.\examples</span><span class="se">\f</span><span class="s1">eatures</span><span class="se">\1</span><span class="s1">_first_scenario.feature:2&#39;</span>
<span class="mi">0008</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">println</span>     <span class="mi">5</span>
<span class="mi">0010</span>    <span class="mi">11</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">reset_context</span>
<span class="mi">0011</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">hook_before</span> <span class="mi">0</span>
<span class="mi">0013</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">constant</span>    <span class="mi">2</span> <span class="s1">&#39;&lt;.\examples</span><span class="se">\f</span><span class="s1">eatures</span><span class="se">\1</span><span class="s1">_first_scenario.feature:5&gt;&#39;</span>
<span class="mi">0015</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">define_var</span>  <span class="mi">3</span> <span class="s1">&#39;.\examples</span><span class="se">\f</span><span class="s1">eatures</span><span class="se">\1</span><span class="s1">_first_scenario.feature:5&#39;</span>
<span class="mi">0017</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">get_var</span>     <span class="mi">3</span> <span class="s1">&#39;.\examples</span><span class="se">\f</span><span class="s1">eatures</span><span class="se">\1</span><span class="s1">_first_scenario.feature:5&#39;</span>
<span class="mi">0019</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">call</span>        <span class="mi">0</span>
<span class="mi">0021</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">hook_after</span>  <span class="mi">0</span>
<span class="mi">0023</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">func_return</span>
</pre></div>
</div>
<p>Here we start with some printing operations to the terminal and then we call the scenario itself. Again, the function name is the location at line 5: <code class="docutils literal notranslate"><span class="pre">.\examples\features\1_first_scenario.feature:5</span></code>. Right before and after the scenario call the hooks are invoked, when they are implemented.</p>
<p>And finally, we have the scenario call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">==</span> <span class="o">.</span>\<span class="n">examples</span>\<span class="n">features</span>\<span class="mi">1</span><span class="n">_first_scenario</span><span class="o">.</span><span class="n">feature</span><span class="p">:</span><span class="mi">5</span> <span class="o">==</span>
<span class="mi">0000</span>    <span class="mi">5</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">print_linebreak</span>
<span class="mi">0001</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">constant</span>    <span class="mi">1</span> <span class="s1">&#39;Scenario: First Scenario&#39;</span>
<span class="mi">0003</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="nb">print</span>       <span class="mi">0</span>
<span class="mi">0005</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">print_indent</span>
<span class="mi">0006</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">constant</span>    <span class="mi">0</span> <span class="s1">&#39;.\examples</span><span class="se">\f</span><span class="s1">eatures</span><span class="se">\1</span><span class="s1">_first_scenario.feature:5&#39;</span>
<span class="mi">0008</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">println</span>     <span class="mi">5</span>
<span class="mi">0010</span>    <span class="mi">6</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">init_scenario</span>
<span class="mi">0011</span>    <span class="mi">7</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">jump_if_failed</span>      <span class="mi">17</span>
<span class="mi">0013</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">hook_before_step</span>
<span class="mi">0014</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">call_step</span>   <span class="mi">3</span> <span class="s1">&#39;An empty box&#39;</span>
<span class="mi">0016</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">hook_after_step</span>
<span class="mi">0017</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">constant</span>    <span class="mi">3</span> <span class="s1">&#39;An empty box&#39;</span>
<span class="mi">0019</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">constant</span>    <span class="mi">2</span> <span class="s1">&#39;.\examples</span><span class="se">\f</span><span class="s1">eatures</span><span class="se">\1</span><span class="s1">_first_scenario.feature:6&#39;</span>
<span class="mi">0021</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">print_step_result</span>
<span class="mi">0022</span>    <span class="mi">8</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">jump_if_failed</span>      <span class="mi">28</span>
<span class="mi">0024</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">hook_before_step</span>
<span class="mi">0025</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">call_step</span>   <span class="mi">5</span> <span class="s1">&#39;I place 2 x &quot;apple&quot; in it&#39;</span>
<span class="mi">0027</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">hook_after_step</span>
<span class="mi">0028</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">constant</span>    <span class="mi">5</span> <span class="s1">&#39;I place 2 x &quot;apple&quot; in it&#39;</span>
<span class="mi">0030</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">constant</span>    <span class="mi">4</span> <span class="s1">&#39;.\examples</span><span class="se">\f</span><span class="s1">eatures</span><span class="se">\1</span><span class="s1">_first_scenario.feature:7&#39;</span>
<span class="mi">0032</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">print_step_result</span>
<span class="mi">0033</span>    <span class="mi">11</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">jump_if_failed</span>     <span class="mi">39</span>
<span class="mi">0035</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">hook_before_step</span>
<span class="mi">0036</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">call_step</span>   <span class="mi">7</span> <span class="s1">&#39;The box contains 2 item(s)&#39;</span>
<span class="mi">0038</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">hook_after_step</span>
<span class="mi">0039</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">constant</span>    <span class="mi">7</span> <span class="s1">&#39;The box contains 2 item(s)&#39;</span>
<span class="mi">0041</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">constant</span>    <span class="mi">6</span> <span class="s1">&#39;.\examples</span><span class="se">\f</span><span class="s1">eatures</span><span class="se">\1</span><span class="s1">_first_scenario.feature:8&#39;</span>
<span class="mi">0043</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">print_step_result</span>
<span class="mi">0044</span>    <span class="o">|</span>  <span class="n">op_code</span><span class="p">::</span><span class="n">func_return</span>
</pre></div>
</div>
<p>You can find all according <code class="docutils literal notranslate"><span class="pre">op_codes</span></code> here. From loading the variables to the jump condition <code class="docutils literal notranslate"><span class="pre">jump_if_failed</span></code> and the hooks before and after step. The scenario name gets resolved at runtime.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="cucumber-cpp: A C++20 Cucumber Interpreter by Coding with Thomas" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="01_cucumber_cpp.html" class="btn btn-neutral float-right" title="Cucumber cpp" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Thomas.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>